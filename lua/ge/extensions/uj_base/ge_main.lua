local a={}local b=1;local c=0;local d=0;local e,f,g,h;local function i()if f.restrictActions then extensions.core_input_actionFilter.setGroup('uj_base',f.disabledActions)extensions.core_input_actionFilter.addAction(0,'uj_base',true)log("I",e.name,"disabled "..#f.disabledActions.." actions")end end;local function j()if f.motd.enabled then guihooks.trigger('ScenarioChange',{name=f.motd.title,description=f.motd.description,introType=f.motd.type})end end;local function k(l,m)local n=core_environment.getTimeOfDay()n.time=math.abs(l+m/60-12)/12*0.5;core_environment.setTimeOfDay(n)end;local function o()if f.timesync.enabled then local p=os.date("!*t",os.time()+f.timesync.offsetHours*60*60)k(p.hour,p.min)end end;local function q(m)if f.timesync.realtime and f.timesync.enabled then local p=os.date("!*t",os.time()+(f.timesync.offsetHours*60+m)*60)k(p.hour,p.min)end end;local function r(s)if not f.reset.enabled then guihooks.trigger('toastrMsg',{type="warning",title=f.reset.title,msg=f.reset.disabledMessage,config={timeOut=f.messageDuration}})return end;if d>=f.reset.timeout or f.reset.timeout==-1 then d=0;be:resetVehicle(s)else local t=f.reset.message;t=t:gsub("{secondsLeft}",math.floor(f.reset.timeout-d))guihooks.trigger('toastrMsg',{type="warning",title=f.reset.title,msg=t,config={timeOut=f.messageDuration}})end end;local function u()g=extensions.freeroam_freeroam.onResetGameplay;extensions.freeroam_freeroam.onResetGameplay=r end;local function v()e=jsonReadFile("settings/resource.json")f=require("settings/config")log("I",e.name,"version "..e.version.." loaded")if f.motd.enabled then guihooks.trigger("ChangeState",{state="scenario-start"})end;if f.restrictMenu then extensions.core_gamestate.setGameState("scenario","freeroam","uj_base")end;i()o()u()end;local function w()extensions.core_input_actionFilter.addAction(0,'uj_base',false)extensions.core_gamestate.setGameState("freeroam","freeroam","freeroam")extensions.freeroam_freeroam.onResetGameplay=g;log("I",e.name,"version "..e.version.." unloaded, goodbye!")end;local function x(y,z,A)c=c+y;d=d+y;if c>=b then q(c/60)end end;local function B(C,D)local E=be:getPlayerVehicle(0)if E then core_vehicles.replaceVehicle(C,D)else core_vehicles.spawnNewVehicle(C,D)end end;local function F(G)if G=="start"then j()elseif G=="play"then if not h then B("pickup",{})end end end;local function H(I)if f.motd.type=="selectableVehicle"then j()if I.model and I.config then local J=createPlayerSpawningData(I.model,I.config,I.color,I.licenseText)B(J.model,J.options)h=true end end end;a.onExtensionLoaded=v;a.onExtensionUnloaded=w;a.onUpdate=x;a.onScenarioUIReady=F;a.onVehicleSelected=H;a.trackVehReset=trackVehReset;return a